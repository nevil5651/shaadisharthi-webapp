server {
    listen 80;

    # â€” Redirect bare paths to trailing slash so SPA asset URLs resolve correctly
    location = /admin { return 301 /admin/; }
    location = /provider { return 301 /provider/; }

    # Admin React (served from /usr/share/nginx/html/admin/)
    location /admin/ {
        alias /usr/share/nginx/html/admin/;
        index index.html;
        # SPA fallback: internal redirect to /admin/index.html (not to full filesystem path)
        try_files $uri $uri/ /admin/index.html;
    }

    # Provider Angular (served from /usr/share/nginx/html/provider/browser/)
    location /provider/ {
    alias /usr/share/nginx/html/provider/browser/;
    index index.html;
    try_files $uri $uri/ /provider/index.html;
}

    # WebSocket route for customer notifications
    location /ws/customer {
    proxy_pass http://shaadisharthi-backend:8080/CustomerSocket;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $host;
    proxy_read_timeout 86400;
    proxy_send_timeout 86400;
    }




    # Customer (Next.js SSR)
    location /customer {
        proxy_pass http://shaadisharthi-next:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Backend APIs
    location /api {
        proxy_pass http://shaadisharthi-backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Root redirect
    location = / {
        return 302 /customer/;
    }
}
